# Build Progress: Extended Visual Reasoning (Map Tool)
# Spec ID: 007-extended-visual-reasoning-map-tool

## Status: In Progress
## Last Updated: 2026-01-06

---

## Implementation Plan Summary

### Phase 1: Core Schema & Type Updates âœ“ COMPLETE
- [x] 1.1 Update VisualOperationData with new diagram types
- [x] 1.2 Update MAP_TOOL schema in index.ts
- [x] 1.3 Update web tool schemas

### Phase 2: Mermaid Generation Engine
- [x] 2.1 Create MermaidGenerator utility class
- [x] 2.2 Implement Sequence Diagram generation
- [x] 2.3 Implement State Machine Diagram generation
- [x] 2.4 Implement Entity-Relationship Diagram generation
- [x] 2.5 Implement Mind Map generation
- [x] 2.6 Implement System Context Diagram generation
- [x] 2.7 Add Mermaid generation for existing diagram types

### Phase 3: MapServer Integration
- [x] 3.1 Update MapServer to use MermaidGenerator
- [ ] 3.2 Update formatOutput for new diagram types

### Phase 4: Comprehensive Testing
- [ ] 4.1 Create MermaidGenerator tests
- [ ] 4.2 Update MapServer tests for new diagram types
- [ ] 4.3 Run test suite and verify all pass

### Phase 5: Web Playground Integration
- [ ] 5.1 Update map-demo-data with new diagram examples
- [ ] 5.2 Add diagram type labels and icons
- [ ] 5.3 Update handleMap for Mermaid output

### Phase 6: Documentation
- [ ] 6.1 Update map.md with new diagram types
- [ ] 6.2 Add Sequence Diagram example
- [ ] 6.3 Add State Machine example
- [ ] 6.4 Add Entity-Relationship example
- [ ] 6.5 Add Mind Map example
- [ ] 6.6 Add System Context example
- [ ] 6.7 Add Mermaid rendering guide
- [ ] 6.8 Update README.md with visualization section

### Phase 7: Final Validation & Build
- [ ] 7.1 Build and verify no TypeScript errors
- [ ] 7.2 Integration test with MCP client
- [ ] 7.3 Verify web playground renders diagrams

---

## New Diagram Types

| Type | Mermaid Syntax | Use Case |
|------|---------------|----------|
| sequenceDiagram | sequenceDiagram | Component interactions, API flows |
| stateMachine | stateDiagram-v2 | System behavior, state transitions |
| erDiagram | erDiagram | Database schemas, data relationships |
| mindMap | mindmap | Brainstorming, idea organization |
| contextDiagram | C4Context | System architecture overview |

---

## Key Files to Modify

### Core Server
- src/models/interfaces.ts - Add diagram types to VisualOperationData
- src/index.ts - Update MAP_TOOL schema
- src/tools/mapServer.ts - Integrate MermaidGenerator

### New Files
- src/tools/mermaidGenerator.ts - Mermaid syntax generation
- src/tools/mermaidGenerator.test.ts - Tests for generator

### Web Integration
- web/lib/tools/map.ts - Update schema and handler
- web/components/demos/map-demo-data.ts - Add demo examples

### Documentation
- docs/tools/map.md - Extended examples
- docs/tools/README.md - Update visualization section

---

## Notes
- All existing tests must continue to pass
- Mermaid output is optional - only generated when elements provided
- C4Context requires special initialization syntax
- Mind maps require Mermaid v9.3+
